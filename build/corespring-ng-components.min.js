// Generated by CoffeeScript 1.3.3
/*
----------------------------------------------------------
Corespring Angular components (corespring-ng-components)
@link https://github.com/thesib/corespring-ng-components
----------------------------------------------------------
*/(function(){}).call(this);(function(){angular.module("cs.directives",[]);angular.module("cs",["cs.directives"]).value("cs.config",{})}).call(this);(function(){angular.module("cs.directives").directive("aceEditor",function($timeout){var definition;definition={replace:true,template:"<div/>",link:function(scope,element,attrs){var AceMode,applyValue,attachResizeEvents,initialData,mode,theme;applyValue=function(obj,property,value){var nextProp,props;if(!(obj!=null)){throw"Cannot apply to null object the property:  "+property+" with value: "+value}if(property.indexOf(".")===-1){scope.$apply(function(){return obj[property]=value})}else{props=property.split(".");nextProp=props.shift();applyValue(obj[nextProp],props.join("."),value)}return null};attachResizeEvents=function(events){var event,eventsArray,_i,_len;eventsArray=events.split(",");for(_i=0,_len=eventsArray.length;_i<_len;_i++){event=eventsArray[_i];scope.$on(event,function(){return $timeout(function(){scope.editor.resize();if(scope.aceModel!=null){return scope.editor.getSession().setValue(scope.$eval(scope.aceModel))}})})}return null};if(attrs["aceResizeEvents"]!=null){attachResizeEvents(attrs["aceResizeEvents"])}scope.editor=ace.edit(element[0]);scope.editor.getSession().setUseWrapMode(true);theme=attrs["aceTheme"]||"eclipse";scope.editor.setTheme("ace/theme/"+theme);mode=attrs["aceMode"]||"xml";AceMode=require("ace/mode/"+mode).Mode;scope.editor.getSession().setMode(new AceMode);scope.aceModel=attrs["aceModel"];initialData=scope.$eval(scope.aceModel);scope.editor.getSession().setValue(initialData);return scope.editor.getSession().on("change",function(){var newValue;newValue=scope.editor.getSession().getValue();return applyValue(scope,scope.aceModel,newValue)})}};return definition})}).call(this);(function(){angular.module("cs.directives").directive("fileUploader",function($rootScope){var definition;definition={replace:false,link:function(scope,element,attrs){var $fuHiddenInput,createFileInput,fuUid,handleFileSelect,maxSize,maxSizeKb,mode,onLocalFileLoadEnd,uploadClick;mode="multipart";if(attrs.fuMode==="raw"){mode="raw"}maxSizeKb=parseInt(attrs.fuMaxSize)||200;maxSize=maxSizeKb*1024;fuUid="file_upload_input_"+Math.round(Math.random()*1e4);$fuHiddenInput=null;uploadClick=function(){return $fuHiddenInput.trigger("click")};createFileInput=function(){var styleDef,_this=this;styleDef="position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; visibility: hidden; padding: 0px; margin: 0px; line-height: 0px;";scope.fileInput='<input \n       type="file" \n       id="'+fuUid+'"\n       style="'+styleDef+'" \n       name="'+attrs.fuName+'">\n</input>';$(element).parent().append(scope.fileInput);$fuHiddenInput=$(element).parent().find("#"+fuUid);$fuHiddenInput.change(function(event){return handleFileSelect(event)});return null};handleFileSelect=function(event){var file,files,reader,_this=this;files=event.target.files;file=event.target.files[0];reader=new FileReader;reader.onloadend=function(event){return onLocalFileLoadEnd(file,event)};reader.readAsBinaryString(file);return null};onLocalFileLoadEnd=function(file,event){var callback,name,options,uploader,url,_this=this;if(file.size>maxSize){$rootScope.$broadcast("fileSizeGreaterThanMax",file,maxSizeKb);return}url=attrs.fuUrl;if(attrs.fuUrl.indexOf("()")!==-1){callback=attrs.fuUrl.replace("(","").replace(")","");if(typeof scope[callback]==="function"){url=scope[callback](file)}}name=attrs.fuName;options={onLoadStart:function(){return $rootScope.$broadcast("uploadStarted")},onUploadComplete:function(responseText){return $rootScope.$broadcast("uploadCompleted",responseText)}};if(mode==="raw"){uploader=new com.ee.RawFileUploader(file,event.target.result,url,name,options)}else{uploader=new com.ee.MultipartFileUploader(file,event.target.result,url,name,options)}uploader.beginUpload();return null};createFileInput();element.bind("click",uploadClick);return null}};return definition})}).call(this);(function(){if(!XMLHttpRequest.prototype.sendAsBinary){XMLHttpRequest.prototype.sendAsBinary=function(dataStr){var byteValue,ords,ui8a;byteValue=function(x){return x.charCodeAt(0)&255};ords=Array.prototype.map.call(dataStr,byteValue);ui8a=new Uint8Array(ords);this.send(ui8a.buffer);return null}}window.com||(window.com={});com.ee||(com.ee={});this.com.ee.XHRWrapper=function(){function XHRWrapper(file,formBody,url,name,options){var now,_this=this;this.file=file;this.formBody=formBody;this.url=url;this.name=name;this.options=options;formBody=this.binaryData;now=(new Date).getTime();this.request=new XMLHttpRequest;this.request.upload.index=0;this.request.upload.file=this.file;this.request.upload.downloadStartTime=now;this.request.upload.currentStart=now;this.request.upload.currentProgress=0;this.request.upload.startData=0;this.request.open("POST",this.url,true);this.request.setRequestHeader("Accept","application/json");if(this.options.onLoadStart!=null){this.options.onLoadStart()}this.request.onload=function(){if(_this.options.onUploadComplete!=null){return _this.options.onUploadComplete(_this.request.responseText)}}}XHRWrapper.prototype.setRequestHeader=function(name,value){this.request.setRequestHeader(name,value);return null};XHRWrapper.prototype.beginUpload=function(){this.request.sendAsBinary(this.formBody);return null};return XHRWrapper}();this.com.ee.RawFileUploader=function(){function RawFileUploader(file,binaryData,url,name,options){this.file=file;this.binaryData=binaryData;this.url=url;this.name=name;this.options=options;this.xhr=new com.ee.XHRWrapper(this.file,this.binaryData,this.url,this.name,this.options);this.xhr.setRequestHeader("Accept","application/json")}RawFileUploader.prototype.beginUpload=function(){return this.xhr.beginUpload()};return RawFileUploader}();this.com.ee.MultipartFileUploader=function(){function MultipartFileUploader(file,binaryData,url,name,options){var boundary,formBody,uid;this.file=file;this.binaryData=binaryData;this.url=url;this.name=name;this.options=options;uid=Math.floor(Math.random()*1e5);boundary="------multipartformboundary"+uid;formBody=this._buildMultipartFormBody(this.file,this.binaryData,boundary);this.xhr=new com.ee.XHRWrapper(this.file,formBody,this.url,this.name,this.options);this.xhr.setRequestHeader("content-type","multipart/form-data; boundary="+boundary);this.xhr.setRequestHeader("Accept","application/json")}MultipartFileUploader.prototype.beginUpload=function(){return this.xhr.beginUpload()};MultipartFileUploader.prototype._buildMultipartFormBody=function(file,fileBinaryData,boundary){var fileParams,formBuilder,params;formBuilder=new com.ee.MultipartFormBuilder(boundary);params=this.options.additionalData;fileParams=[{file:file,data:fileBinaryData,paramName:this.name}];return formBuilder.buildMultipartFormBody(params,fileParams,boundary)};return MultipartFileUploader}()}).call(this);(function(){window.com||(window.com={});com.ee||(com.ee={});this.com.ee.MultipartFormBuilder=function(){function MultipartFormBuilder(boundary){this.boundary=boundary;this.dashdash="--";this.crlf="\r\n"}MultipartFormBuilder.prototype.buildMultipartFormBody=function(params,fileParams){var output,_this=this;output="";if(params!=null){$.each(params,function(i,val){if(typeof val==="function"){val=val()}return output+=_this.buildFormSegment(i,val)})}if(fileParams!=null){$.each(fileParams,function(i,val){output+=_this.buildFileFormSegment(val.paramName,val.file,val.data);return null})}output+=this.dashdash;output+=this.boundary;output+=this.dashdash;output+=this.crlf;return output};MultipartFormBuilder.prototype.buildFormSegment=function(key,value){var contentDisposition;contentDisposition=this._buildContentDisposition(key);return this._buildFormSegment(contentDisposition,value)};MultipartFormBuilder.prototype._buildContentDisposition=function(name){var template;template='Content-Disposition: form-data; name="${name}" ';return template.replace("${name}",name)};MultipartFormBuilder.prototype._buildFileContentDisposition=function(formName,fileName){var out;this.template='Content-Disposition: form-data; name="${formName}"; filename="${fileName}" ';out=this.template.replace("${formName}",formName);out=out.replace("${fileName}",fileName);return out};MultipartFormBuilder.prototype.buildFileFormSegment=function(formName,file,binaryData){var contentDisposition;contentDisposition=this._buildFileContentDisposition(formName,file.name);contentDisposition+=this.crlf;contentDisposition+="Content-Type: "+file.type;return this._buildFormSegment(contentDisposition,binaryData)};MultipartFormBuilder.prototype._buildFormSegment=function(contentDisposition,value){var output;output="";output+=this.dashdash;output+=this.boundary;output+=this.crlf;output+=contentDisposition;output+=this.crlf;output+=this.crlf;output+=value;output+=this.crlf;return output};return MultipartFormBuilder}()}).call(this);(function(){angular.module("cs.directives").directive("loadingButton",[function(){var definition;definition={require:"ngModel",link:function(scope,element,attrs){return scope.$watch(attrs["ngModel"],function(newValue){var command;command=newValue?"loading":"reset";return $(element).button(command)})}};return definition}])}).call(this);(function(){angular.module("cs.directives").directive("whenScrolled",function(){var fn;fn=function(scope,elm,attr){var funCheckBounds,raw;raw=elm[0];funCheckBounds=function(){var rectObject;rectObject=raw.getBoundingClientRect();if(rectObject.height===0){return}if(rectObject.bottom<=window.innerHeight){scope.$apply(attr.whenScrolled)}return null};return angular.element(window).bind("scroll",funCheckBounds)};return fn})}).call(this);